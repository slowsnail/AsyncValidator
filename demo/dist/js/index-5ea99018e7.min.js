!function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=t("../../../src/index"),o=r(i),a=new o.default(".js-async-form",[{selector:".js-username",rules:["required","max_length:2","min_length:1"],events:["blur","keyup"],handler:function(t){t.status?t.element.style.backgroundColor="green":t.element.style.backgroundColor="red"}},{selector:".js-idcard",rules:["idcard"],events:["blur","keyup"]},{selector:".js-period",rules:["min_length:2","max_length:5"],events:["keyup"]}],{validateType:"all",commonHandler:function(t){t.status?t.element.style.backgroundColor="green":t.element.style.backgroundColor="red"}});a.go()},{"../../../src/index":6}],2:[function(t,e,n){(function(r,i){!function(t,r){"object"==typeof n&&"undefined"!=typeof e?e.exports=r():"function"==typeof define&&define.amd?define(r):t.ES6Promise=r()}(this,function(){"use strict";function e(t){return"function"==typeof t||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function o(t){W=t}function a(t){B=t}function u(){return function(){return r.nextTick(d)}}function s(){return"undefined"!=typeof K?function(){K(d)}:f()}function l(){var t=0,e=new Q(d),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function c(){var t=new MessageChannel;return t.port1.onmessage=d,function(){return t.port2.postMessage(0)}}function f(){var t=setTimeout;return function(){return t(d,1)}}function d(){for(var t=0;t<R;t+=2){var e=nt[t],n=nt[t+1];e(n),nt[t]=void 0,nt[t+1]=void 0}R=0}function h(){try{var e=t,n=e("vertx");return K=n.runOnLoop||n.runOnContext,s()}catch(t){return f()}}function v(t,e){var n=arguments,r=this,i=new this.constructor(p);void 0===i[it]&&q(i);var o=r._state;return o?!function(){var t=n[o-1];B(function(){return S(o,i,t,r._result)})}():O(r,i,t,e),i}function m(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(p);return A(n,t),n}function p(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function _(t){try{return t.then}catch(t){return st.error=t,st}}function w(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function b(t,e,n){B(function(t){var r=!1,i=w(n,e,function(n){r||(r=!0,e!==n?A(t,n):k(t,n))},function(e){r||(r=!0,j(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&i&&(r=!0,j(t,i))},t)}function P(t,e){e._state===at?k(t,e._result):e._state===ut?j(t,e._result):O(e,void 0,function(e){return A(t,e)},function(e){return j(t,e)})}function T(t,e,r){e.constructor===t.constructor&&r===v&&e.constructor.resolve===m?P(t,e):r===st?j(t,st.error):void 0===r?k(t,e):n(r)?b(t,e,r):k(t,e)}function A(t,n){t===n?j(t,y()):e(n)?T(t,n,_(n)):k(t,n)}function E(t){t._onerror&&t._onerror(t._result),x(t)}function k(t,e){t._state===ot&&(t._result=e,t._state=at,0!==t._subscribers.length&&B(x,t))}function j(t,e){t._state===ot&&(t._state=ut,t._result=e,B(E,t))}function O(t,e,n,r){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+at]=n,i[o+ut]=r,0===o&&t._state&&B(x,t)}function x(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)r=e[a],i=e[a+n],r?S(n,r,i,o):i(o);t._subscribers.length=0}}function C(){this.error=null}function M(t,e){try{return t(e)}catch(t){return lt.error=t,lt}}function S(t,e,r,i){var o=n(r),a=void 0,u=void 0,s=void 0,l=void 0;if(o){if(a=M(r,i),a===lt?(l=!0,u=a.error,a=null):s=!0,e===a)return void j(e,g())}else a=i,s=!0;e._state!==ot||(o&&s?A(e,a):l?j(e,u):t===at?k(e,a):t===ut&&j(e,a))}function F(t,e){try{e(function(e){A(t,e)},function(e){j(t,e)})}catch(e){j(t,e)}}function L(){return ct++}function q(t){t[it]=ct++,t._state=void 0,t._result=void 0,t._subscribers=[]}function H(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[it]||q(this.promise),X(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&k(this.promise,this._result))):j(this.promise,z())}function z(){return new Error("Array Methods must be provided an Array")}function D(t){return new H(this,t).promise}function N(t){var e=this;return new e(X(t)?function(n,r){for(var i=t.length,o=0;o<i;o++)e.resolve(t[o]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function V(t){var e=this,n=new e(p);return j(n,t),n}function $(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Y(t){this[it]=L(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&$(),this instanceof Y?F(this,t):Z())}function I(){var t=void 0;if("undefined"!=typeof i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=Y}var U=void 0;U=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var X=U,R=0,K=void 0,W=void 0,B=function(t,e){nt[R]=t,nt[R+1]=e,R+=2,2===R&&(W?W(d):rt())},G="undefined"!=typeof window?window:void 0,J=G||{},Q=J.MutationObserver||J.WebKitMutationObserver,tt="undefined"==typeof self&&"undefined"!=typeof r&&"[object process]"==={}.toString.call(r),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,nt=new Array(1e3),rt=void 0;rt=tt?u():Q?l():et?c():void 0===G&&"function"==typeof t?h():f();var it=Math.random().toString(36).substring(16),ot=void 0,at=1,ut=2,st=new C,lt=new C,ct=0;return H.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===ot&&n<t;n++)this._eachEntry(e[n],n)},H.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===m){var i=_(t);if(i===v&&t._state!==ot)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===Y){var o=new n(p);T(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},H.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===ot&&(this._remaining--,t===ut?j(r,n):this._result[e]=n),0===this._remaining&&k(r,this._result)},H.prototype._willSettleAt=function(t,e){var n=this;O(t,void 0,function(t){return n._settledAt(at,e,t)},function(t){return n._settledAt(ut,e,t)})},Y.all=D,Y.race=N,Y.resolve=m,Y.reject=V,Y._setScheduler=o,Y._setAsap=a,Y._asap=B,Y.prototype={constructor:Y,then:v,catch:function(t){return this.then(null,t)}},Y.polyfill=I,Y.Promise=Y,Y})}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],3:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function a(t){if(d===clearTimeout)return clearTimeout(t);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function u(){p&&v&&(p=!1,v.length?m=v.concat(m):y=-1,m.length&&s())}function s(){if(!p){var t=o(u);p=!0;for(var e=m.length;e;){for(v=m,m=[];++y<e;)v&&v[y].run();y=-1,e=m.length}v=null,p=!1,a(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var f,d,h=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(t){f=r}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(t){d=i}}();var v,m=[],p=!1,y=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new l(t,e)),1!==m.length||p||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],4:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw"add pattern - no name";if(!e)throw"add pattern - no options";if(!e.message)throw"add paattern - no options.message";if(!e.validate)throw"add pattern - no options.validate";return c[t]=l.default.extend({name:t},e),this}function a(){}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.addPattern=o;var s=t("./utils"),l=r(s),c={},f=function(){function t(e,n,r){if(i(this,t),this.container=e,this.field=n,this.commonHandler=r||a,!this.container)throw"FieldValidator - no container";if(!this.field)throw"FieldValidator - no field";this.selector=n.selector,this.rules=n.rules||[],this.events=n.events||[],this.validateType=n.validateType||"one",this.handler=n.handler,this.element=this.container.querySelector(this.selector),this.bindEvents()}return u(t,[{key:"bindEvents",value:function(){var t=this;if(this.events.length>0)for(var e=0;e<this.events.length;e++){var n=this.events[e];this.element.addEventListener(n,function(){t.validate().then(function(e){t.retHandler(e)})},!1)}}},{key:"retHandler",value:function(t){"function"==typeof this.handler?this.handler(t):this.commonHandler(t)}},{key:"createPromiseList",value:function(){var t=[];if(this.rules.length>0)for(var e=0;e<this.rules.length;e++){var n=this.rules[e];t.push(this.createPromise(n))}return t}},{key:"createPromise",value:function(t){var e=this;return new Promise(function(n,r){function i(t){n(l.default.extend(f,{status:t}))}var o=t.split(":")[0],a=t.split(":")[1],u=c[o]&&c[o].message,s=c[o]&&c[o].argument;s&&(u=u&&u.replace(/%argu/,a));var f={rule:t,status:!1,message:u},d=c[o]&&c[o].validate;"function"==typeof d?d.call(f,e.element.value,i):n(l.default.extend(f,{status:!1,message:"无效的验证规则，验证不通过"}))})}},{key:"validate",value:function(){return"all"===this.validateType?this._validateAll():"one"===this.validateType?this._validateOne():void 0}},{key:"_validateAll",value:function(){var t=this,e={element:this.element,value:this.element.value},n=this.createPromiseList();return Promise.all(n).then(function(n){return e.status=n.every(function(t){return t.status}),e.data=n,t.retHandler(e),e})}},{key:"_validateOne",value:function(){var t=this.createPromiseList(),e=this.promiseCreatorList(t);return l.default.promiseSeq(e)}},{key:"promiseCreatorList",value:function(t){for(var e=this,n=[],r={element:this.element,value:this.element.value,status:!1,data:[]},i=function(i){n.push(function(n){return n.rule&&r.data.push(n),n.status?t[i].then(function(t){return r.data.push(t),r.status=r.data.every(function(t){return t.status}),e.retHandler(r),r}):(e.retHandler(r),new Promise(function(t){return t(r)}))})},o=0;o<t.length;o++)i(o);return n}}]),t}();n.default=f},{"./utils":7}],5:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(){}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("./FieldValidator"),s=r(u),l=t("./utils"),c=r(l),f=function(){function t(e,n,r){if(i(this,t),this.formElement=document.querySelector(e),this.fields=n,this.validateType=r&&r.validateType||"one",this.commonHandler=r&&r.commonHandler||o,!this.formElement)throw"FormValidator - no formElement"}return a(t,[{key:"createFieldList",value:function(){for(var t=[],e=0;e<this.fields.length;e++){var n=this.fields[e],r=this.formElement.querySelector(n.selector);if(r){var i=new s.default(this.formElement,n,this.commonHandler);t.push(i)}}return t}},{key:"validate",value:function(){return"all"===this.validateType?this._validateAll():"one"===this.validateType?this._validateOne():void 0}},{key:"_validateAll",value:function(){for(var t={element:this.formElement,status:!1},e=this.createFieldList(),n=[],r=0;r<e.length;r++)n.push(e[r].validate());return Promise.all(n).then(function(e){return t.status=e.every(function(t){return t.status}),t.data=e,t})}},{key:"_validateOne",value:function(){var t=this.createFieldList(),e=this.promiseCreatorList(t);return c.default.promiseSeq(e)}},{key:"promiseCreatorList",value:function(t){for(var e=this,n={element:this.formElement,status:!1,data:[]},r=[],i=function(i){r.push(function(r){return r.element&&r.element!=e.formElement&&n.data.push(r),r.status?t[i].validate().then(function(e){return i===t.length-1?(n.data.push(e),n.status=n.data.every(function(t){return t.status}),n):e}):new Promise(function(t){return t(n)})})},o=0;o<t.length;o++)i(o);return r}}]),t}();n.default=f},{"./FieldValidator":4,"./utils":7}],6:[function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("es6-promise"),s=t("./FormValidator"),l=i(s),c=t("./FieldValidator"),f=r(c);(0,u.polyfill)();var d={ID:function(t){if(t=t.toUpperCase(),!/(^\d{15}$)|(^\d{17}(\d|X)$)/.test(t))return-1;var e,n;if(e=t.length,15==e){n=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/);var r=t.match(n),i=new Date("19"+r[2]+"/"+r[3]+"/"+r[4]),o=i.getYear()==Number(r[2])&&i.getMonth()+1==Number(r[3])&&i.getDate()==Number(r[4]);return o?1:-2}if(18==e){n=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})(\d|X)$/);var r=t.match(n),i=new Date(r[2]+"/"+r[3]+"/"+r[4]),o=i.getFullYear()==Number(r[2])&&i.getMonth()+1==Number(r[3])&&i.getDate()==Number(r[4]);if(o){var a,u,s=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),l=new Array("1","0","X","9","8","7","6","5","4","3","2"),c=0;for(u=0;u<17;u++)c+=t.substr(u,1)*s[u];return a=l[c%11],a!=t.substr(17,1)?-2:1}return-2}return-2}};f.addPattern("required",{message:"该项不能为空",validate:function(t,e){e(""!==t)}}).addPattern("non-required",{message:"允许为空",validate:function(t,e){e(""===t)}}).addPattern("numeric",{message:"必须为数字",validate:function(t,e){e(/^\d+$/.test(t))}}).addPattern("alpha",{message:"必须为字母",validate:function(t,e){e(/^[a-z]+$/i.test(t))}}).addPattern("alpha_numeric",{message:"必须为字母或数字",validate:function(t,e){e(/^[a-z0-9]+$/i.test(t))}}).addPattern("idcard",{message:"身份证格式错误",validate:function(t,e){e(1===d.ID(t))}}).addPattern("email",{message:"邮件地址错误",validate:function(t,e){var n=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;resoleve(n.test(t))}}).addPattern("min_length",{argument:!0,message:"最少输入%argu个字",validate:function(t,e){var n=parseInt(this.rule.split(":")[1],10);e(t.length>=n)}}).addPattern("max_length",{argument:!0,message:"最多输入%argu个字",validate:function(t,e){var n=parseInt(this.rule.split(":")[1],10);e(t.length<=n)}});var h=function(){function t(e,n,r){o(this,t),this.form=new l.default(e,n,r),this.addPattern=f.addPattern}return a(t,[{key:"go",value:function(){this.form.validate().then(function(t){console.log("async-ret: ",t)}).catch(function(t){return console.log(t)})}}]),t}();n.default=h},{"./FieldValidator":4,"./FormValidator":5,"es6-promise":2}],7:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={};r.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},r.promiseSeq=function(t){var e=Promise.resolve({status:!0});return t.forEach(function(t){e=e.then(function(e){return t(e)})}),e},n.default=r},{}]},{},[1]);